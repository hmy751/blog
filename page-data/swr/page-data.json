{"componentChunkName":"component---src-templates-blog-post-js","path":"/swr/","result":{"data":{"site":{"siteMetadata":{"title":"hmy75d blog"}},"markdownRemark":{"id":"54e82d22-3339-50cf-b118-e45f69d001fb","excerpt":"swr라이브러리 코드를 구현해보면서 학습한 내용을 글로 정리했습니다. 이 글은 swr라이브러리의 사용법 보다는 내부를 파악한 내용으로 구성되어 있습니다. swr내부에는 크게 어떤 요소들로 이루어져 있고, 또 어떤 흐름으로 활용되는지 설명하겠습니다. SWR…","html":"<p>swr라이브러리 코드를 구현해보면서 학습한 내용을 글로 정리했습니다. 이 글은 swr라이브러리의 사용법 보다는 내부를 파악한 내용으로 구성되어 있습니다. swr내부에는 크게 어떤 요소들로 이루어져 있고, 또 어떤 흐름으로 활용되는지 설명하겠습니다.</p>\n<h2>SWR 주요 요소들</h2>\n<hr>\n<p>앞으로 설명드릴 주요 요소들의 코드 디렉토리는 다음과 같이 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">├── _internal\n│   └── utils\n│       ├── config-context.ts\n│       ├── config.ts\n│       ├── global-state.ts\n│       ├── resolve-args.ts\n│       └── use-swr-config.ts\n│           ...\n└── core\n    └── use-swr.ts\n\t\t\t\t...</code></pre></div>\n<p>전체적으로 크게 <code class=\"language-text\">SWRGlobalState</code>와 <code class=\"language-text\">config</code>, 그리고 <code class=\"language-text\">useSwr</code>로 구성되어 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/5c9784703cb57e551d0936bfa647ebee/a3bed/structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhElEQVR42oVT25aCMAzkC6Q0vYIiirues/uw//912ZlSFH3AhzG0kMlkEpuu63QLs8a21ev5rH8/P/p7v2ufUrkzb9+/o3knE2s1OVfIcgjaHg7aGaOXcdRT36sX2SV9IbRA9r6Qfl+vehoGPUCVQ4H77VZISRhxNp8I+QGVrQotVAUk8+wAwfuIM59D/W6fEASrOkaL6GtiIQZ4T4W+FjKfWiYySNjqEUNgay2tqKrjBrstt/CJ0WMICbiAcG3fVZCECql2STYlz7QGQ+sWkJCVQoww3muPKfKZ6yGVZIvim6BVa1S86Pw16ziNuEMXDu8sCD1+plMPZOxafEy7KIev9NZUj0sSMM0XPc+TuujVJfgdRC0KMDZeastIiILK9ukH18VuprmqyEPWOGDRbffSspCwNds9NFDpNcakAV4O9BLD8fAu5aTpmIuKRTWKR/cyEJ4bgR/rBdUSZrNKjwTuYnBFZWnPyaLYbAmhMDqDiWIwIHKy/z8tZCAukZAnWJAe/gNktz4rr0YxvQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"structure\"\n        title=\"\"\n        src=\"/blog/static/5c9784703cb57e551d0936bfa647ebee/f058b/structure.png\"\n        srcset=\"/blog/static/5c9784703cb57e551d0936bfa647ebee/c26ae/structure.png 158w,\n/blog/static/5c9784703cb57e551d0936bfa647ebee/6bdcf/structure.png 315w,\n/blog/static/5c9784703cb57e551d0936bfa647ebee/f058b/structure.png 630w,\n/blog/static/5c9784703cb57e551d0936bfa647ebee/40601/structure.png 945w,\n/blog/static/5c9784703cb57e551d0936bfa647ebee/78612/structure.png 1260w,\n/blog/static/5c9784703cb57e551d0936bfa647ebee/a3bed/structure.png 1721w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>SWRGlobalState</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/4d4237460d90d6796d29681997606dfe/99072/swrGlobalState.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGUlEQVR42m2TS3PiQAyEfQ8BP7AN+IF52RDwhsCF3DbX/P//o/16amaL2uxhauSR1Gq15ChJEvv3xP6M7+/2+Py02/1ul3F096/r1fI8t1kcW/qf3OgHEIH5fG7rxcKuu52N260du87eNhsb1ms7tK0tsswS4mb+pD8AvaMEqKZ6RUJbFFZw52lqGTFzjvx7Ctxged7v7VBVtuBNucJwgLE3mrK0FWANQWq14Hs6mznWCaCyq6axD3y/Hw/7ALSpa6spvFut/nboGKrSErDJdGpD39v315edj0eb8p0CFoLFtFsuHdMNt9i9UkhE9K7WIzGrqDLB4QL5TgFqsHNajr1GaqtF19Mw2NvlYiPnjKbyOfZgSPdIlWa+7QMtlDhSwBY4tzAP7OYwbfDtDwe73242nE7WE18QG/sZCCsSqipI/J6KK0AatGqZ5sBkM8+u8AOTthfYVYAp1wH6mDW+qPOAclQkaAA1wS+TidNmTtthAxQr9kf0LbFX2M+AGlC0g2buk5RQApLjyABWC2HJA8MlE5V+Ld1Ib72LkAo7DWW4RC009p4EMdNden3C0kpDaXvVyiCJWsz8Fmh1lB/FfmGFrgc5dWtdwoRT/wdJkjOL3TOQM+ulVcuI7fwKqUu3hy4RAIG2VC3Dymgl8KklnVdsN2kAeoa35a69PKGT6Pk/VoWghVoQuGwtvgCksfZNcqjdoH389C//AXwAZL4sVQP+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"swrGlobalState.png\"\n        title=\"\"\n        src=\"/blog/static/4d4237460d90d6796d29681997606dfe/f058b/swrGlobalState.png\"\n        srcset=\"/blog/static/4d4237460d90d6796d29681997606dfe/c26ae/swrGlobalState.png 158w,\n/blog/static/4d4237460d90d6796d29681997606dfe/6bdcf/swrGlobalState.png 315w,\n/blog/static/4d4237460d90d6796d29681997606dfe/f058b/swrGlobalState.png 630w,\n/blog/static/4d4237460d90d6796d29681997606dfe/99072/swrGlobalState.png 842w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">SWRGlobalState</code>는 <code class=\"language-text\">swr</code>에서 관리되는 <code class=\"language-text\">cache</code>를 키로 하고, 전역에서 상태를 관리하는 요소들로 이루어진 <code class=\"language-text\">GlobalState</code>를 값으로 맵핑한 <code class=\"language-text\">WeakMap</code> 자료구조로 되어 있습니다.</p>\n<blockquote>\n<p>💡 <code class=\"language-text\">WeakMap</code>이란?<br> <code class=\"language-text\">WeakMap</code>은 <code class=\"language-text\">Map</code>과 같은 객체 자료구조로이지만 차이점은 키로 원시값이 대신 객체만 받게 됩니다. 여기서는 키로 <code class=\"language-text\">Cache</code>라는 객체를 받게 됩니다.\n또한 <code class=\"language-text\">Map</code>과의 차이점은 프로그램 내에 객체에 대한 참조가 <code class=\"language-text\">WeakMap</code>을 제외하고 존재하지 않으면 가비지로 수거되는 특징이 있습니다.\n그래서 메모리 누수에서 이점이 있고 <code class=\"language-text\">swr</code>에서는 이러한 이점을 이용하기 위해 <code class=\"language-text\">WeakMap</code>을 이용한것으로 보입니다.</p>\n</blockquote>\n<p>여기서 <code class=\"language-text\">cache</code>는 데이터를 저장하고 활용하는 메커니즘이며 형태는 <code class=\"language-text\">useSwr</code>을 구분하는 고유한 식별자 <code class=\"language-text\">key</code>와, 그에 해당하는 데이터 <code class=\"language-text\">state</code>를 맵핑하는 인스턴스입니다.</p>\n<p><code class=\"language-text\">GlobalState</code>는 <code class=\"language-text\">swr</code>에서 사용되는 상태를 관리하는 요소들의 집합이며 <code class=\"language-text\">Revalidators</code>, <code class=\"language-text\">Mutations</code>, <code class=\"language-text\">Fetch</code>, <code class=\"language-text\">Preload</code>, <code class=\"language-text\">Mutator</code>, <code class=\"language-text\">Setter</code>, <code class=\"language-text\">Subscriber</code>등을 배열로 저장합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// global-state.ts</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> SWRGlobalState <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WeakMap<span class=\"token operator\">&lt;</span>Cache<span class=\"token punctuation\">,</span> GlobalState<span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">...</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">GlobalState</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> RevalidateCallback<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Revalidators</span>\n  Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Mutations: [ts, end_ts]</span>\n  Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Fetch: [data, ts]</span>\n  Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> FetcherResponse<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">>></span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Preload</span>\n  ScopedMutator<span class=\"token punctuation\">,</span> <span class=\"token comment\">// Mutator</span>\n  <span class=\"token punctuation\">(</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> prev<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Setter</span>\n  <span class=\"token punctuation\">(</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>current<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> prev<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span> <span class=\"token comment\">// Subscriber</span>\n<span class=\"token punctuation\">]</span>\n\n<span class=\"token operator\">...</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Cache<span class=\"token operator\">&lt;</span>Data <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> IterableIterator<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span>\n  <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> State<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span>\n  <span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> State<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n  <span class=\"token keyword\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3>Config</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 595px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/28fbd1720d1b4bf6baaab7665a637d77/3dd3e/config.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABs0lEQVR42m1S2XKjMBDkaR9iQAcCCXQAduIrEFdczv9/WmdGjrOu2n1odExremboQimFB6RUaJoWfT9AN4bOEs/xDLp7HQacQsgYug7iiVc8NoKTKSLPEbfPFYfdTGcBqTSBYlqjqmu8jSPeCX82G0RrsaSEihJqiueETNaEZCV2fY3BlBiaF3hT0R2hK9GaBrevL5yOR3xcLljmGWeqbqXE5kfo0U3R0GdyEs5IWFL0MWHwIaOn1nZTxOdpi3lKaNsOVVWhJFhjIISA9x636w1bEpFSoIhWwLUKL2WFkRTXdcFhv8eRqlmWd/gQ0RmNrSvzrFi07/u8F7WATT3CPsFNA1SjUSSqrqolQvAYqCIm8/p46JyjuMAhCIwpksiK6/WKaZzQBYvGNfd2SbSdLIo3L/OD7XbOVZ3PZ3q05HVd11x1zXGvc1sxxix0+bhg2s9QnYamGeuWEzoUkxPoqeVNVef5MOr6776sqC2jMBKPh89z44qYI4WEGVq0ycKENifOtnntBVng/uvvNrmDzyw2Oo6pX2sweJ/5lJShGPLHNkwInczW4fUZvpO/pv/H5P/BNzDi/TH4cO4EAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"config.png\"\n        title=\"\"\n        src=\"/blog/static/28fbd1720d1b4bf6baaab7665a637d77/3dd3e/config.png\"\n        srcset=\"/blog/static/28fbd1720d1b4bf6baaab7665a637d77/c26ae/config.png 158w,\n/blog/static/28fbd1720d1b4bf6baaab7665a637d77/6bdcf/config.png 315w,\n/blog/static/28fbd1720d1b4bf6baaab7665a637d77/3dd3e/config.png 595w\"\n        sizes=\"(max-width: 595px) 100vw, 595px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">config</code>는 <code class=\"language-text\">swr</code>에 사용되는 옵션 값들과 <code class=\"language-text\">cache</code>를 담고 있으며 <code class=\"language-text\">useSwr</code>에 제공합니다.</p>\n<p>우선 <code class=\"language-text\">config</code>의 구성은 이미 선언된 <code class=\"language-text\">defaultConfig</code>와 선택적으로 지정하여 사용할 수 있는 상위 <code class=\"language-text\">SWRConfigContext</code>에서 상속받은 값을 병합하여 최종적으로 형성됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// config.ts</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>cache<span class=\"token punctuation\">,</span> mutate<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">initCache</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token punctuation\">[</span>Cache<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> ScopedMutator<span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> defaultConfig<span class=\"token operator\">:</span> FullConfiguration <span class=\"token operator\">=</span> <span class=\"token function\">mergeObjects</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>\n    onLoadingSlow<span class=\"token operator\">:</span> noop<span class=\"token punctuation\">,</span>\n    onSuccess<span class=\"token operator\">:</span> noop<span class=\"token punctuation\">,</span>\n    onError<span class=\"token operator\">:</span> noop<span class=\"token punctuation\">,</span>\n    onErrorRetry<span class=\"token punctuation\">,</span>\n    onDiscarded<span class=\"token operator\">:</span> noop<span class=\"token punctuation\">,</span>\n\n    revalidateOnFocus<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    revalidateOnReconnect<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    revalidateIfStale<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    shouldRetryOnError<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    errorRetryInterval<span class=\"token operator\">:</span> slowConnection <span class=\"token operator\">?</span> <span class=\"token number\">10000</span> <span class=\"token operator\">:</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span>\n    focusThrottleInterval<span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n    dedupingInterval<span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n    loadingTimeout<span class=\"token operator\">:</span> slowConnection <span class=\"token operator\">?</span> <span class=\"token number\">5000</span> <span class=\"token operator\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\n\n    compare<span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">isPaused</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    cache<span class=\"token punctuation\">,</span> <span class=\"token comment\">//초기 캐시값</span>\n    mutate<span class=\"token punctuation\">,</span>\n    fallback<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  preset<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>여기서 상위 <code class=\"language-text\">config</code>는 <code class=\"language-text\">SWRConfig</code>(<code class=\"language-text\">SWRConfigContext.Provider</code>)를 통해서 형성되며, 이는 하위 컴포넌트에 전달 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// config-context.ts</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> SWRConfigContext <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createContext</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Partial<span class=\"token operator\">&lt;</span>FullConfiguration<span class=\"token operator\">>></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> SWRConfig<span class=\"token operator\">:</span> <span class=\"token constant\">FC</span><span class=\"token operator\">&lt;</span>\n  PropsWithChildren<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span>\n    value<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Config <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>parentConfig<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Config<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Config<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n<span class=\"token operator\">></span> <span class=\"token operator\">=</span> props <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> value <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> props\n  <span class=\"token keyword\">const</span> parentConfig <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>SWRConfigContext<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> isFunctionalConfig <span class=\"token operator\">=</span> <span class=\"token function\">isFunction</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>isFunctionalConfig <span class=\"token operator\">?</span> <span class=\"token function\">value</span><span class=\"token punctuation\">(</span>parentConfig<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>isFunctionalConfig<span class=\"token punctuation\">,</span> parentConfig<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> extendedConfig <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>isFunctionalConfig <span class=\"token operator\">?</span> config <span class=\"token operator\">:</span> <span class=\"token function\">mergeConfigs</span><span class=\"token punctuation\">(</span>parentConfig<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>isFunctionalConfig<span class=\"token punctuation\">,</span> parentConfig<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span>\n\n\t<span class=\"token operator\">...</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n    SWRConfigContext<span class=\"token punctuation\">.</span>Provider<span class=\"token punctuation\">,</span>\n    <span class=\"token function\">mergeObjects</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      value<span class=\"token operator\">:</span> extendedConfig\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3>useSwr</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 610px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/fe1f92b5ce515adeb294b0341ba15915/5aae9/useSwr.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.46835443037975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVR42o2SzU7DMBCE8wKx1/+O47RpQlsqaC7Ahfd/r2Ft0yJVIHEY2ZHXn2dn0yml8Ku0hk2uKXuoQSOtGaftjOP1jOWywiTbzqOFGRyMM+huAM2AO4wIdmwwZRkcHJbjgumwgzAS0hLI8h1vmlxZNdwuNCAxQIgeUkp21r4LUCkNkoSYI64fW3VXAEqWR9vDTbznOssuOyKJNI54eb0ipVShRhvYyVe3tSXe9+VBrnW8NwVaQA8xGa7tJJNTdHheMqaccTydsW0bDpcFshcwwdZWigttSq6+dSGoui+qcF4NZ9mNnjAHgaAF1qHHfgyY5wVvn+/srAVdHPo1Ip5ThZvbEAbbFLiGVzdzhodBQpBGz/Ic9tPEBz7ykFS9VAptmWZ2td0qhjb5qjrA8gBH0e0jh25bHlMgjE5yXnSf9j18+dPio9R322WYndGENUmcRoHM7eu//st/6gtT6N+7m38GjgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"useSwr.png\"\n        title=\"\"\n        src=\"/blog/static/fe1f92b5ce515adeb294b0341ba15915/5aae9/useSwr.png\"\n        srcset=\"/blog/static/fe1f92b5ce515adeb294b0341ba15915/c26ae/useSwr.png 158w,\n/blog/static/fe1f92b5ce515adeb294b0341ba15915/6bdcf/useSwr.png 315w,\n/blog/static/fe1f92b5ce515adeb294b0341ba15915/5aae9/useSwr.png 610w\"\n        sizes=\"(max-width: 610px) 100vw, 610px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">useSwr</code>은 컴포넌트 영역에서 직접 사용되는 <code class=\"language-text\">hook</code>입니다. 데이터를 패칭하고 <code class=\"language-text\">state</code>를 관리하며 필요에 따라 데이터를 재검증합니다.\n<code class=\"language-text\">config</code>의 <code class=\"language-text\">cache</code>와 옵션 값을 전달받아 컴포넌트에 이용될 <code class=\"language-text\">state</code>를 관리합니다.</p>\n<h2>실행 과정</h2>\n<hr>\n<h3>초기 캐시 전달과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/a63bdf16802de38a2588ebc958fcec13/d38ac/flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVR42o2T23LCMAxE+QAgji1fcyOQgT70/39P3Q0mwzC05UHj2JbWZ+V417atvobhaIwGEf2+3fRrWXQeR7VY2/Z/id07MW+tdimtIsfDQQ/7vfal6PV00uy9Oux/JEixBCqpgtfzWbuctXSdXqZpDVIz52PCSEHnNCBou4dwB7qx73WGYKqEzDO1Bf8TQoyFLKJ9i3VaHUA7QJxrHjnmL0L7NLLwBCKKs6ip5JxPsF9i3ABeKTfBY9OosAgWEwrYK9ouICNdqvMgXnscZkFJ6yEEQOCSTBU0+HC21WkcNMYAwXw/uW3XAqmFUq0b5OY+q0TBWPRyWzRkEAvcidWdtwb9gs2SdBo69K/aQKw9ghDnj7AeB3iQd1nnZdZ+GrRhvq2CwRn1PuiIf474nCeQCqzRPu1xPaINGfSkMY1ZRx9w4+JWIVq2rgoKelR4eygksTCJFms49G6LeP8HSfq4kBdBvAyKQojinL99jk+WKUDbkv0a1t8pufcDPPong8lrXT8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flow.png\"\n        title=\"\"\n        src=\"/blog/static/a63bdf16802de38a2588ebc958fcec13/f058b/flow.png\"\n        srcset=\"/blog/static/a63bdf16802de38a2588ebc958fcec13/c26ae/flow.png 158w,\n/blog/static/a63bdf16802de38a2588ebc958fcec13/6bdcf/flow.png 315w,\n/blog/static/a63bdf16802de38a2588ebc958fcec13/f058b/flow.png 630w,\n/blog/static/a63bdf16802de38a2588ebc958fcec13/40601/flow.png 945w,\n/blog/static/a63bdf16802de38a2588ebc958fcec13/78612/flow.png 1260w,\n/blog/static/a63bdf16802de38a2588ebc958fcec13/d38ac/flow.png 1744w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n프로젝트 초기 실행시 <code class=\"language-text\">defaultConfig</code>가 기본으로 사용됩니다. 물론 상위 컴포넌트에 <code class=\"language-text\">SWRConfig</code>를 통해서 하위 컴포넌트의 <code class=\"language-text\">useSwr</code>에 제공할수 있지만 <code class=\"language-text\">SWRConfig</code>를 사용하지 않는 것을 가정으로 설명하겠습니다.</p>\n<p>먼저 <code class=\"language-text\">initCache</code>를 호출을 통해 초기 <code class=\"language-text\">cache</code>를 반환합니다. 여기서 초기 <code class=\"language-text\">cache</code>는 맵 인스턴스로 <code class=\"language-text\">initCache</code>의 인자로 호출됩니다. 인자로 받은 <code class=\"language-text\">provider</code>를 <code class=\"language-text\">SWRGlobalState</code>에 <code class=\"language-text\">GlobalState</code>의 초기 값으로 맵핑하여 형성 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// cache.ts</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> initCache <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>Data <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n  provider<span class=\"token operator\">:</span> Cache<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Partial<span class=\"token operator\">&lt;</span>ProviderConfiguration<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n  <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span>Cache<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> ScopedMutator<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">]</span>\n  <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span>Cache<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> ScopedMutator<span class=\"token punctuation\">]</span>\n  <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>SWRGlobalState<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>provider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> opts <span class=\"token operator\">=</span> <span class=\"token function\">mergeObjects</span><span class=\"token punctuation\">(</span>defaultConfigOptions<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token constant\">EVENT_REVALIDATORS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> mutate <span class=\"token operator\">=</span> <span class=\"token function\">internalMutate</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token constant\">UNDEFINED</span><span class=\"token punctuation\">,</span> provider<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> ScopedMutator\n    <span class=\"token keyword\">let</span> unmount <span class=\"token operator\">=</span> noop\n\n    <span class=\"token keyword\">const</span> subscriptions<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>current<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> prev<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span>\n      <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">subscribe</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n      key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>current<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> prev<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> subs <span class=\"token operator\">=</span> subscriptions<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n      subscriptions<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> subs\n\n      subs<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> subs<span class=\"token punctuation\">.</span><span class=\"token function\">splice</span><span class=\"token punctuation\">(</span>subs<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> prev<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      provider<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> subs <span class=\"token operator\">=</span> subscriptions<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>subs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> fn <span class=\"token keyword\">of</span> subs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">,</span> prev<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">initProvider</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>SWRGlobalState<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>provider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t    <span class=\"token comment\">// SWRGlbalState에 provider(Cache)를 키로,</span>\n\t\t\t\t<span class=\"token comment\">// 배열에 값들(GlobalState)들이 밸류로 맵핑됩니다.</span>\n        SWRGlobalState<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>provider<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n\t\t\t\t\t<span class=\"token comment\">// 배열에는 GlobalState값인 Revalidators, Mutations,</span>\n\t\t\t\t\t<span class=\"token comment\">// Fetch, Preload, Mutator, Setter, Subscriber 등이 저장됩니다.</span>\n          <span class=\"token constant\">EVENT_REVALIDATORS</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          mutate<span class=\"token punctuation\">,</span>\n          setter<span class=\"token punctuation\">,</span>\n          subscribe\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n\t\t\t\t<span class=\"token operator\">...</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">initProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\t\t<span class=\"token comment\">// SWRGLobalState가 맵핑된 후 Cache값인 provider를 반환합니다.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>provider<span class=\"token punctuation\">,</span> mutate<span class=\"token punctuation\">,</span> initProvider<span class=\"token punctuation\">,</span> unmount<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n\t<span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>이렇게 만들어진 <code class=\"language-text\">cache</code>와 옵션으로 <code class=\"language-text\">defaultConfig</code>가 선언됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">\n<span class=\"token comment\">// config.ts</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>cache<span class=\"token punctuation\">,</span> mutate<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">initCache</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token punctuation\">[</span>Cache<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> ScopedMutator<span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> cache<span class=\"token punctuation\">,</span> mutate<span class=\"token punctuation\">,</span> compare <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 기본 설정</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> defaultConfig<span class=\"token operator\">:</span> FullConfiguration <span class=\"token operator\">=</span> <span class=\"token function\">mergeObjects</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>\n    onLoadingSlow<span class=\"token operator\">:</span> noop<span class=\"token punctuation\">,</span>\n    onSuccess<span class=\"token operator\">:</span> noop<span class=\"token punctuation\">,</span>\n    onError<span class=\"token operator\">:</span> noop<span class=\"token punctuation\">,</span>\n    onErrorRetry<span class=\"token punctuation\">,</span>\n    onDiscarded<span class=\"token operator\">:</span> noop<span class=\"token punctuation\">,</span>\n\n    revalidateOnFocus<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    revalidateOnReconnect<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    revalidateIfStale<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    shouldRetryOnError<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    errorRetryInterval<span class=\"token operator\">:</span> slowConnection <span class=\"token operator\">?</span> <span class=\"token number\">10000</span> <span class=\"token operator\">:</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span>\n    focusThrottleInterval<span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n    dedupingInterval<span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n    loadingTimeout<span class=\"token operator\">:</span> slowConnection <span class=\"token operator\">?</span> <span class=\"token number\">5000</span> <span class=\"token operator\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\n\n    compare<span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">isPaused</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token comment\">// 여기에 cache가 전달됩니다.</span>\n    cache<span class=\"token punctuation\">,</span>\n    mutate<span class=\"token punctuation\">,</span>\n    fallback<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>초기에 상위 <code class=\"language-text\">config</code>가 없기 때문에 <code class=\"language-text\">defaultConfig</code>만 <code class=\"language-text\">useSwrConfig</code>를 통해서 반환되고 이 <code class=\"language-text\">useSwrConfig</code>가 <code class=\"language-text\">withArgs</code>를 통해서 <code class=\"language-text\">fallbackConfig</code>로 전달됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// use-swr-config.ts</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> useSWRConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> FullConfiguration <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">mergeObjects</span><span class=\"token punctuation\">(</span>defaultConfig<span class=\"token punctuation\">,</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>SWRConfigContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// resolve-args.ts</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> withArgs <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SWRType</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">(hook: any) => </span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useSWRArgs</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> fallbackConfig <span class=\"token operator\">=</span> <span class=\"token function\">useSWRConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">,</span> _config<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">normalize</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token function\">mergeConfigs</span><span class=\"token punctuation\">(</span>fallbackConfig<span class=\"token punctuation\">,</span> _config<span class=\"token punctuation\">)</span>\n\n\t\t<span class=\"token operator\">...</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token function\">hook</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> fn <span class=\"token operator\">||</span> config<span class=\"token punctuation\">.</span>fetcher <span class=\"token operator\">||</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">unknown</span> <span class=\"token keyword\">as</span> SWRType\n<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n</span></code></pre></div>\n<p><code class=\"language-text\">config</code>를 가지고 있는 <code class=\"language-text\">withArgs</code>는 <code class=\"language-text\">useSwrHandler</code>를 인자로 호출하여 <code class=\"language-text\">useSwr</code>로 선언합니다. 이러한 형태로 <code class=\"language-text\">withArgs</code>를 통해 <code class=\"language-text\">config</code>를 최종적으로 <code class=\"language-text\">useSwrHandler</code>에 전달하며 사용됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// use-swr.ts</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> useSWRHandler <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>Data <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> Error <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n  _key<span class=\"token operator\">:</span> Key<span class=\"token punctuation\">,</span>\n  fetcher<span class=\"token operator\">:</span> Fetcher<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  config<span class=\"token operator\">:</span> FullConfiguration <span class=\"token operator\">&amp;</span> SWRConfiguration<span class=\"token operator\">&lt;</span>Data<span class=\"token punctuation\">,</span> Error<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    cache<span class=\"token punctuation\">,</span>\n\t  <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> config<span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">...</span>\n\n<span class=\"token keyword\">const</span> useSWR <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">withArgs</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>SWRHook<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>useSWRHandler<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> useSWR</code></pre></div>\n<p><code class=\"language-text\">useSwrHandler</code>는 <code class=\"language-text\">useSwr</code>의 시작점으로 <code class=\"language-text\">useSwr</code>의 내부를 핸들링하는 기본 함수입니다.</p>\n<p>앞서 과정을 통해 <code class=\"language-text\">cache</code>가 담긴 <code class=\"language-text\">config</code>가 <code class=\"language-text\">useSwrHandler</code>에 전달됩니다.</p>\n<p>전달받은 <code class=\"language-text\">cache</code>는 리액트에서 활용하는 내부 상태가 아닌 외부스토어로서 <code class=\"language-text\">useSyncExternalStore</code>를 통해 리액트에 반영하여 컴포넌트에서 이용될 <code class=\"language-text\">state</code>를 동기화 합니다.</p>\n<p>여기서 <code class=\"language-text\">useSyncExternalStore</code>는 리액트 내부 상태가 아닌 외부 스토어를 구독하고, 이를 리액트 컴포넌트와 동기화하는데 도와주는 리액트 훅입니다.</p>\n<p>이때 <code class=\"language-text\">useSyncExternalStore</code>에는 첫 번째 인자로 외부 상태값을 구독하는 함수, 그리고 두 번째 인자로 컴포넌트에 이용될 외부 스토어의 스냅샷이 필요합니다.</p>\n<p>코드에서는 구독함수로는 <code class=\"language-text\">GlobalState</code>의 <code class=\"language-text\">subscribeCache</code>, 스냅샷으로는 <code class=\"language-text\">getSnapshot</code>이 이용됩니다.</p>\n<p><code class=\"language-text\">getSnapshot</code>은 <code class=\"language-text\">cache</code>에 대한 스냅샷이며, 스냅샷이 변경될 때마다 리렌더링을 발생시킵니다. 또 <code class=\"language-text\">subscribeCache</code>는 구독함수로서, <code class=\"language-text\">isEqual</code>을 통해서 <code class=\"language-text\">cache</code>의 변화가 생기면 <code class=\"language-text\">callback</code>을 호출하여 리렌더링을 발생시킵니다.</p>\n<p>이러한 방식으로 외부데이터 <code class=\"language-text\">cache</code>의 변화를 감지하여 컴포넌트에 반영하게 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// use-swr.ts</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> useSWRHandler <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>Data <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> Error <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n  _key<span class=\"token operator\">:</span> Key<span class=\"token punctuation\">,</span>\n  fetcher<span class=\"token operator\">:</span> Fetcher<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  config<span class=\"token operator\">:</span> FullConfiguration <span class=\"token operator\">&amp;</span> SWRConfiguration<span class=\"token operator\">&lt;</span>Data<span class=\"token punctuation\">,</span> Error<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    cache<span class=\"token punctuation\">,</span>\n\t  <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> config<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">,</span> fnArg<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span>_key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>getCache<span class=\"token punctuation\">,</span> setCache<span class=\"token punctuation\">,</span> subscribeCache<span class=\"token punctuation\">,</span> getInitialCache<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span>\n\t  <span class=\"token generic-function\"><span class=\"token function\">createCacheHelper</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>\n      Data<span class=\"token punctuation\">,</span>\n      State<span class=\"token operator\">&lt;</span>Data<span class=\"token punctuation\">,</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">{</span>\n        _k<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Key\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>cache<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token operator\">...</span>\n\n\t<span class=\"token keyword\">const</span> getSnapshot <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token operator\">...</span>\n\t\t<span class=\"token keyword\">const</span> cachedData <span class=\"token operator\">=</span> <span class=\"token function\">getCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">const</span> clientSnapshot <span class=\"token operator\">=</span> <span class=\"token function\">getSelectedCache</span><span class=\"token punctuation\">(</span>cachedData<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> serverSnapshot <span class=\"token operator\">=</span>\n      cachedData <span class=\"token operator\">===</span> initialData\n        <span class=\"token operator\">?</span> clientSnapshot\n        <span class=\"token operator\">:</span> <span class=\"token function\">getSelectedCache</span><span class=\"token punctuation\">(</span>initialData<span class=\"token punctuation\">)</span>\n\n\t\t<span class=\"token operator\">...</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n\t\t\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> clientSnapshot<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> serverSnapshot\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>cache<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> cached <span class=\"token operator\">=</span> <span class=\"token function\">useSyncExternalStore</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        <span class=\"token function\">subscribeCache</span><span class=\"token punctuation\">(</span>\n          key<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">(</span>current<span class=\"token operator\">:</span> State<span class=\"token operator\">&lt;</span>Data<span class=\"token punctuation\">,</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> prev<span class=\"token operator\">:</span> State<span class=\"token operator\">&lt;</span>Data<span class=\"token punctuation\">,</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isEqual</span><span class=\"token punctuation\">(</span>prev<span class=\"token punctuation\">,</span> current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// eslint-disable-next-line react-hooks/exhaustive-deps</span>\n      <span class=\"token punctuation\">[</span>cache<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    getSnapshot<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    getSnapshot<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">const</span> cachedData <span class=\"token operator\">=</span> cached<span class=\"token punctuation\">.</span>data\n\n\t<span class=\"token keyword\">const</span> returnedData <span class=\"token operator\">=</span> keepPreviousData\n    <span class=\"token operator\">?</span> <span class=\"token function\">isUndefined</span><span class=\"token punctuation\">(</span>cachedData<span class=\"token punctuation\">)</span>\n      <span class=\"token operator\">?</span> laggyDataRef<span class=\"token punctuation\">.</span>current\n      <span class=\"token operator\">:</span> cachedData\n    <span class=\"token operator\">:</span> data\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    mutate<span class=\"token operator\">:</span> boundMutate<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">get</span> <span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> returnedData\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> SWRResponse<span class=\"token operator\">&lt;</span>Data<span class=\"token punctuation\">,</span> Error<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> useSWR <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">withArgs</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>SWRHook<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>useSWRHandler<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> useSWR</code></pre></div>\n<h3>상위 Config 전달과정</h3>\n<p>만약 상위에 <code class=\"language-text\">SWRConfig</code>를 이용하게 되면 전역적으로 <code class=\"language-text\">config</code>를 제공할수 있습니다.</p>\n<p>상위 <code class=\"language-text\">context</code>를 통해 전달받은 <code class=\"language-text\">SwrConfigContext</code>를 <code class=\"language-text\">useSwrConfig</code>에서 <code class=\"language-text\">SwrConfigContext</code>를 우선순위로 <code class=\"language-text\">defaultConfig</code>와 병합합니다. 새로 병합된 <code class=\"language-text\">config</code>는 이전에 설명한 방식과 같은 방법으로 <code class=\"language-text\">withArgs</code>를 통해 최종적으로 <code class=\"language-text\">useSwr</code>에 전달됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// use-swr-config.ts</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> useSWRConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> FullConfiguration <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">mergeObjects</span><span class=\"token punctuation\">(</span>defaultConfig<span class=\"token punctuation\">,</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>SWRConfigContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>추가로 <code class=\"language-text\">SWRConfig</code>내부 로직 중 <code class=\"language-text\">SWRConfigContext</code>, <code class=\"language-text\">extendedConfig</code>를 통해서 <code class=\"language-text\">SWRConfig</code>의 중첩을 통한 <code class=\"language-text\">config</code>전달도 가능하게 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// config-context.ts</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> SWRConfigContext <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createContext</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Partial<span class=\"token operator\">&lt;</span>FullConfiguration<span class=\"token operator\">>></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> SWRConfig<span class=\"token operator\">:</span> <span class=\"token constant\">FC</span><span class=\"token operator\">&lt;</span>\n  PropsWithChildren<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span>\n    value<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Config <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>parentConfig<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Config<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Config<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n<span class=\"token operator\">></span> <span class=\"token operator\">=</span> props <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> value <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> props\n  <span class=\"token keyword\">const</span> parentConfig <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>SWRConfigContext<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> isFunctionalConfig <span class=\"token operator\">=</span> <span class=\"token function\">isFunction</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>isFunctionalConfig <span class=\"token operator\">?</span> <span class=\"token function\">value</span><span class=\"token punctuation\">(</span>parentConfig<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>isFunctionalConfig<span class=\"token punctuation\">,</span> parentConfig<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> extendedConfig <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>isFunctionalConfig <span class=\"token operator\">?</span> config <span class=\"token operator\">:</span> <span class=\"token function\">mergeConfigs</span><span class=\"token punctuation\">(</span>parentConfig<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>isFunctionalConfig<span class=\"token punctuation\">,</span> parentConfig<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span>\n\n\t<span class=\"token operator\">...</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n    SWRConfigContext<span class=\"token punctuation\">.</span>Provider<span class=\"token punctuation\">,</span>\n    <span class=\"token function\">mergeObjects</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      value<span class=\"token operator\">:</span> extendedConfig\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2>마치며</h2>\n<p>최근에 swr 라이브러리를 파악해보고자 직접 기본적인구조만 구현해봤고, 이를 토대로 학습한 내용을 정리해봤습니다.</p>\n<p>보통 라이브러리를 적용하고 내부 개념을 학습하는데서 끝났는데, 이번 기회에 내부 구조를 파악하면서 어떤 방식으로 개발하는지도 조금은 이해할 수 있었습니다.</p>\n<p>과정자체는 굉장히 힘들고 오래걸렸지만 그만큼 더 많은 것 을 배울수 있었던 것 같습니다.</p>","frontmatter":{"title":"swr 내부분석","date":"March 11, 2024","description":"swr라이브러리 코드를 구현해보면서 학습한 내용을 글로 정리했습니다. 이 글은 swr라이브러리의 사용법 보다는 내부를 파악한 내용으로 구성되어 있습니다. swr내부에는 크게 어떤 요소들로 이루어져 있고, 또 어떤 흐름으로 활용되는지 설명하겠습니다."}},"previous":null,"next":null},"pageContext":{"id":"54e82d22-3339-50cf-b118-e45f69d001fb","previousPostId":null,"nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}